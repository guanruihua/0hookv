import{ref as e,toRefs as r,reactive as i}from"vue";import"abandonjs";import{isArray as a,isNumber as t}from"asura-eye";import o from"dayjs";function n(r){return e(r)}function u(e){return r(i(e))}const d=()=>(new Date).getTime().toString(),l=(e={})=>{const{filter:n,timeRange:u}=e,l=i({loading:!1,total:0,dataSource:[],OriginDataSource:[],queryParams:{page:1,limit:10}}),{queryParams:s,total:f,dataSource:c,OriginDataSource:v,loading:m}=r(l),g=e=>{v.value=Array.isArray(e)?[...e].map(((e,r)=>(void 0!==e.id&&""!==e.id||(e.id=d()+"_vid_"+r),e))):[]},p=(e={})=>{const{page:r=1,limit:i=10,...d}=e,l=[],s=e=>{if(!Number.isNaN(e))return"number"==typeof e?e.toString():e};return v.value.forEach((r=>{(r=>{for(const i in d){const l=s(d[i]),f=s(r[i]);if(n&&n[i]){const a={key:i,value:l,recordValue:f,params:e,record:r};if(!n[i](a))return!1}else if(void 0!==l){if(void 0===f)return!1;if(u&&a(u.fields)&&u.fields.includes(i)){const{format:e}=u;if(a(l)&&2===l.length){const r=o(l[0]).valueOf(),i=o(l[1]).valueOf(),a=o(f,e).valueOf();return t(a)&&t(r)&&t(i)&&a>=r&&a<=i}}if(a(l)&&l.includes(f))return!1;if("string"!=typeof l||"string"!=typeof f){if(l!==f)return!1}else if(f.trim().toUpperCase().indexOf(l.trim().toUpperCase())<0)return!1}}return!0})(r)&&l.push(r)})),f.value=l.length,l.slice((r-1)*i,r*i)},y=(e={})=>{m.value=!0;const r={...s.value,...e};s.value=r,c.value=p(r),m.value=!1};return{loading:m,OriginDataSource:v,setOriginDataSource:g,addOriginDataSource:e=>{if(Array.isArray(e)){const r=()=>[...e,...v.value].map(((e,r)=>(void 0!==e.id&&""!==e.id||(e.id=d()+"_vid_add_"+r),e)));v.value=r()}},dataSource:c,total:f,queryParams:s,getPage:y,del:e=>{if(e.id){const r=[...v.value].filter((r=>r.id!==e.id));g(r),y()}},save:e=>{if(void 0===e.id||""===e.id)e.id=d()+"__new__",g([e,...v.value]);else{const r=[...v.value];g(r.map((r=>r.id===e.id?{...r,...e}:r)))}y()}}};export{l as usePageArray,u as useSetState,n as useState};
//# sourceMappingURL=index.esm.js.map
