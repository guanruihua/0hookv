"use strict";var e=require("vue");require("abandonjs");var r=require("asura-eye"),i=require("dayjs");const a=()=>(new Date).getTime().toString();exports.usePageArray=(t={})=>{const{filter:u,timeRange:s}=t,n=e.reactive({loading:!1,total:0,dataSource:[],OriginDataSource:[],queryParams:{page:1,limit:10}}),{queryParams:o,total:d,dataSource:l,OriginDataSource:f,loading:c}=e.toRefs(n),v=e=>{f.value=Array.isArray(e)?[...e].map(((e,r)=>(void 0!==e.id&&""!==e.id||(e.id=a()+"_vid_"+r),e))):[]},g=(e={})=>{const{page:a=1,limit:t=10,...n}=e,o=[],l=e=>{if(!Number.isNaN(e))return"number"==typeof e?e.toString():e};return f.value.forEach((a=>{(a=>{for(const t in n){const o=l(n[t]),d=l(a[t]);if(u&&u[t]){const r={key:t,value:o,recordValue:d,params:e,record:a};if(!u[t](r))return!1}else if(void 0!==o){if(void 0===d)return!1;if(s&&r.isArray(s.fields)&&s.fields.includes(t)){const{format:e}=s;if(r.isArray(o)&&2===o.length){const a=i(o[0]).valueOf(),t=i(o[1]).valueOf(),u=i(d,e).valueOf();return r.isNumber(u)&&r.isNumber(a)&&r.isNumber(t)&&u>=a&&u<=t}}if(r.isArray(o)&&o.includes(d))return!1;if("string"!=typeof o||"string"!=typeof d){if(o!==d)return!1}else if(d.trim().toUpperCase().indexOf(o.trim().toUpperCase())<0)return!1}}return!0})(a)&&o.push(a)})),d.value=o.length,o.slice((a-1)*t,a*t)},m=(e={})=>{c.value=!0;const r={...o.value,...e};o.value=r,l.value=g(r),c.value=!1};return{loading:c,OriginDataSource:f,setOriginDataSource:v,addOriginDataSource:e=>{if(Array.isArray(e)){const r=()=>[...e,...f.value].map(((e,r)=>(void 0!==e.id&&""!==e.id||(e.id=a()+"_vid_add_"+r),e)));f.value=r()}},dataSource:l,total:d,queryParams:o,getPage:m,del:e=>{if(e.id){const r=[...f.value].filter((r=>r.id!==e.id));v(r),m()}},save:e=>{if(void 0===e.id||""===e.id)e.id=a()+"__new__",v([e,...f.value]);else{const r=[...f.value];v(r.map((r=>r.id===e.id?{...r,...e}:r)))}m()}}},exports.useSetState=function(r){return e.toRefs(e.reactive(r))},exports.useState=function(r){return e.ref(r)};
//# sourceMappingURL=index.js.map
